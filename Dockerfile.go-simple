# 单阶段构建 - 更简单的版本
FROM golang:1.21

WORKDIR /app

# 复制所有文件
COPY . .

# 下载依赖并构建
RUN go mod init github.com/hueshu/aiyoutube-proxy || true
RUN go get github.com/gin-gonic/gin@v1.9.1
RUN go get github.com/google/uuid@v1.5.0
RUN go build -o proxy main.go

# 设置环境变量
ENV GIN_MODE=release
ENV PORT=8080

EXPOSE 8080

CMD ["./proxy"]